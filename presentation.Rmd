---
title: "A&E Investigation "
subtitle: "Data Science Project"
author: "Binary_Brigade <br> Connor Finlay, Ade Obawole, Murray Bone, Alexander Patton & Cameron"
institute: "University of Edinburgh"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      
---

```{r install-package, include = FALSE, eval = FALSE}
# Copy and paste the following code into your console to download and install
# the `xaringan` package that contains all of the code which allows you 
# to create presentation slides in Rmarkdown
install.packages('xaringan')
```


```{r load-packages, include = FALSE}
# Add any additional packages you need to this chunk
library(tidyverse)
library(tidymodels)
library(palmerpenguins)
library(knitr)
library(xaringanthemer)
library(cowplot)
```

```{r setup, include=FALSE}
# For better figure resolution
knitr::opts_chunk$set(fig.retina = 3, dpi = 300, fig.width = 6, fig.asp = 0.618, out.width = "80%")
```

```{r load-data, include=FALSE}
# Load your data here
# adding a and e data
aANDe <- read_csv("data/a5f7ca94-c810-41b5-a7c9-25c18d43e5a4.csv")

# adding covid data
covid_nottidy <- read_csv("data/b5e3fa11-8a85-4946-bbb2-2e800d4e3594.csv")

nhs_workforce_nottidy <- read_csv("data/data.csv") # Reads data collected from the NHS Scotland's Turas system about the total amount of vacancies across NHS Scotland's allied health professions. Latest release as of Nov 13 2023 https://turasdata.nes.nhs.scot/data-and-reports/official-workforce-statistics/all-official-statistics-publications/05-september-2023-workforce/dashboards/nhs-scotland-workforce/?pageid=9984
```
```{r tidying data, include=FALSE}
unique(aANDe$DepartmentType)
unique(aANDe$Country)

 AandE <- aANDe %>% 
  mutate(
    weekend_date_correct = ymd(WeekEndingDate),
    quarter = quarter(weekend_date_correct, with_year = TRUE),
    ) %>% # Gets the date information for each observation into the datetime and quarter format
     select(-c(WeekEndingDate, DepartmentType, Country)
         ) # Removes irrelevant (superceded/the same for all observations) from the data set
 
 Covid <- covid_nottidy %>% 
   mutate(
     weekend_date_correct = ymd(Date)
   ) %>% 
   select(-c(Date))

nhs_workforce <- nhs_workforce_nottidy %>%
  mutate(
    census_date = ymd(`Census date`),
    quarter = quarter(census_date, with_year = TRUE),
    vacancies = `Value (WTE)`
  ) %>%
      select(
        -c(`Census date`,`Value (WTE)`,...3,`Vacancy note`)
      )

 AandE_work <- AandE %>%
    inner_join(
      by = "quarter",
      nhs_workforce
    ) %>%
    group_by(quarter) %>%
      summarise(
        med_pct_within4 = median(PercentageWithin4HoursEpisode),
        vacancies = median(vacancies)
      )
```

```{r include=FALSE}

#Background image
style_xaringan(
  title_slide_background_image = "img/hospital.jpg"
)
```

class: center, middle

## How does A&E activity and external factors relate to waiting times in Scotland, and are there any notable trends or patterns over time?

---

class: inverse, center, middle

# Trends in A&E waiting times 

---

class: middle

The median percentage seen to within 4 hours seems to decrease over time (especially after 2020) - Why?
```{r echo=  FALSE}
AandE %>% 
  mutate(year = year(weekend_date_correct)) %>%
  group_by(year) %>% 
  summarise( 
    med_pct_Within4 = median(PercentageWithin4HoursEpisode) ) %>% 
  ggplot( mapping = aes( x = year,
                         y = med_pct_Within4 
                         ) 
          ) + 
  geom_bar(stat='identity') + 
  theme_bw() +
  labs(title = "Percentage of Wait Time Under Four Hours by Year",
       y = "Median % Seen To Within 4 Hours",
       x = "Year")
par(mar = c(5, 5, 5, 5))
```
---
class: inverse, center, middle

#Why during 2020
---
- To investigate wait times during 2020 we joined a data set that contained information about COVID-19
```{r echo=  FALSE}
Covidgraph <- AandE %>% filter(weekend_date_correct > ym("2020-03"), weekend_date_correct <=
ym("2023-09")) 

p1 <- ggplot(Covidgraph, aes(x = weekend_date_correct,
                        y = NumberOfAttendancesEpisode)) +
  geom_smooth() + labs( y = "number of AandE admissions",
                       x = "date",
                        title = "A and E Admissions by Date During Covid pandemic")

p2 <- ggplot(Covid, aes(x = weekend_date_correct,
                  y = NumberAdmitted)) +
  geom_smooth() + labs(x = "date",
                       y = "number of covid hospitalisations",
                       title = "Number of Covid Hospitalisations by date")
combined_plot <- plot_grid(p1, p2)

print(combined_plot)
```
---
- From this it can be seen that there is an inverse relationship between the number of hospital addmisions for COVID and the number of A and E admissions.
- Suggesting the type of healthcare required for people during COVID lockdowns wasn't A&E. This will have driven down the median waiting time. 
- Hence we can state that COVID levels did have an effect on A&E admissions.
---
class: inverse, center, middle

#Effect of staff levels on A&E waiting times
---
#Method Used to Investigate
-To investigate we joined another PHS data set to the A&E data.
  -This data set included information on the quarterly staffing levels in the NHS.
-We fit a linear reggression model to this to establish if there a trend or not.
-FOR CONNOR TO ADD TO
---
#Linear Regression Plotted

# Tables

If you want to generate a table, make sure it is in the HTML format (instead of Markdown or other formats), e.g.,

```{r iris-table, echo = FALSE}
kable(head(iris), format = "html")
```

---

# Images

```{r castle, echo = FALSE, out.width = "55%", fig.align = "center", fig.cap = "Image credit: Photo by JÃ¶rg Angeli on Unsplash."}
include_graphics("img/edinburgh-castle.jpg")
```

Or you can also include a full page image. See next slide.

---


class: inverse, center, middle
background-image: url(img/edinburgh-castle.jpg)
background-size: contain
---

# Math Expressions

You can write LaTeX math expressions inside a pair of dollar signs, e.g. &#36;\alpha+\beta$ renders $\alpha+\beta$. You can use the display style with double dollar signs:

```
$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$
```

$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$

Limitations:

1. The source code of a LaTeX math expression must be in one line, unless it is inside a pair of double dollar signs, in which case the starting `$$` must appear in the very beginning of a line, followed immediately by a non-space character, and the ending `$$` must be at the end of a line, led by a non-space character;

1. There should not be spaces after the opening `$` or before the closing `$`.

1. Math does not work on the title slide (see [#61](https://github.com/yihui/xaringan/issues/61) for a workaround).

---

# Feeling adventurous?

- Want to find out more about `xaringan`? See https://slides.yihui.name/xaringan/#1.

- You are welcome to use the default styling of the slides. In fact, that's what I expect majority of you will do. You will differentiate yourself with the content of your presentation.

- But some of you might want to play around with slide styling. The 
`xaringanthemer` provides some solutions for this that: https://pkg.garrickadenbuie.com/xaringanthemer.

- And if you want more bells and whistles, there is also `xaringanExtra`: https://pkg.garrickadenbuie.com/xaringanExtra.